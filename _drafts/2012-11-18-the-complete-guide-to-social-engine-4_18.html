---
layout: post
title: 'The Complete Guide to Social Engine 4 Module Development Part 5: Menus'
date: '2012-11-18T01:29:00.000-08:00'
author: Marco Enrico
tags:
- module
- development
- menus
- social engine
modified_time: '2013-07-23T02:29:56.307-07:00'
blogger_id: tag:blogger.com,1999:blog-8533127149230967660.post-5465244197205742722
blogger_orig_url: http://social-engine-tutorials.blogspot.com/2012/11/the-complete-guide-to-social-engine-4_18.html
---

To help our users find their way around we need menus. Most of the group of links you find in SE4 pages are menus wrapped within a widget. To be able to create our own menus or add menu items to existing menus we need to take a look at two tables <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menus</span> and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menuitems</span>.<br /><br />The contents of <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menus</span> are the editable menus. That is,&nbsp; menus listed under this table can me manipulated by the admin user in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/admin/menus</span>. The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">name</span> field is the prefix used in the name of the menuitems in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menuitems</span>. This is how you will refer to menu when you retrieve it for use in your code. The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">type</span> field determines if this menu is a custom one created by an admin using the "Add Menu" function in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/admin/menus</span>. The title field is the title of the menu as displayed in the menu editor. This is not visible to end users. The order field determines the order the menu is displayed in the drop down in the menu editor. Note inserting the details of your menu in <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menus</span> only allows admin users to manipulate your menu.<br /><br />The more interesting table is <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menuitems</span>. All the menu items in SE4 standard or otherwise goes here. <br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">name</span> field is the name of the menu item. This is how you will refer to the menu that contains the menu item. For example in our car module we want to have a main navigation menu for cars which will appear beneath the SE4s default header menu. This menu will have 3 items: "Browse", "My Cars", "Create New Car". To do this we need to create 3 menu items <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">car_main_browse</span>, <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">car_main_manage</span> and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">car_main_create</span>. If we want the admins to be able to manipulate this menu all we need to do is to insert a row to <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">engine4_core_menus</span> named <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">car_main</span>.<br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">module</span> field determines which module the menu item is enclosed in. Disabling/enabling the enclosing module disable/enable the display of the menu item.<br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">label</span> field determines the text in the generated link. HTML tags are allowed here.<br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">params</span> field is in JSON format and determines the attributes of the generated link. This set's the parameters for the router that will generate the value of the href tag of the link.&nbsp; Routing is discussed in <a href="{{ site.baseurl }}{% post_url 2012-07-24-the-complete-guide-to-social-engine-4 %}">Part 3</a> of this tutorial. Field/value pairs that is not part of the routing parameters will become attributes of the generated link. Adding "target:_blank" for example will make the link open in a new tab/window. Adding the "uri" parameter and leaving out other routing parameters (route, controller, etc.). Will make the link point to the specified uri. You may use the "javascript:" scheme to make the link execute arbitrary javascript code when clicked.<br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">menu</span> field determines which menu the menu item belongs to while the submenu field determines which submenu it belongs within the menu. Note that css/javascript must be provided for the submenu to look and behave properly.<br /><br />The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">enabled</span> field determines if the menu is displayed or not. The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">custom</span> field determines if the menu item is created via the menu editor in the admin panel.&nbsp; This also determines if the item can be deleted from the menu. The <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">order</span> field determines the order of the item as it appears on the menu.<br /><br />With what we discussed so far we need the following sql statements in the my.sql file of our Car module for our main menu:<br /><br /><script class="brush:sql" type="syntaxhighlighter"><![CDATA[ INSERT IGNORE INTO engine4_core_menus (`name`, `type`, `title`, `order`) VALUES ('car_main', 'standard', 'Car Main Navigation Menu', 999); INSERT IGNORE INTO engine4_core_menuitems (`name`, `module`, `label`, `plugin`, `params`, `menu`, `submenu`, `enabled`, `custom`, `order`) VALUES ('car_main_browse', 'car', 'Browse Cars', 'Car_Plugin_Menus::canViewCars', '{"route":"car_general","action":"browse"}', 'car_main', '', 1, 0, 1), ('car_main_manage', 'car', 'My Cars', 'Car_Plugin_Menus::canCreateCars', '{"route":"car_general","action":"manage"}', 'car_main', '', 1, 0, 2), ('car_main_create', 'car', 'Create Car', 'Car_Plugin_Menus::canCreateCars', '{"route":"car_general","action":"create"}', 'car_main', '', 1, 0, 3); ]]></script> Now we can discuss the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">plugin</span> field. The field comes in two formats: &lt;ClassName&gt; and &lt;ClassName&gt;::&lt;Method&gt;. Using the latter we can control whether the menu item is displayed or not my making the method return true or false depending on the situation.&nbsp; For example:<br /><br /><script class="brush:php" type="syntaxhighlighter"><![CDATA[ class Car_Plugin_Menus {   public function canViewCars()   {     // Check auth     return (bool) Engine_Api::_()-&gt;authorization()-&gt;isAllowed('car', $viewer, 'view');   } } ]]></script> Will make the browse link to display/hide depending on whether the currenly log in user has authorization to view cars (discussed in <a href="{{ site.baseurl }}{% post_url 2012-11-10-the-complete-guide-to-social-engine-4 %}">part 4</a> or this tutorial).<br /><br />Specifying only the the class name of the plugin allows for more flexibility.&nbsp; This will allow you not only to hide/show the menu item but also set the href, icon, style and other attributes of the generated link. A great example of this is the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">Messages_Plugin_Menus</span> which has a method to add the number of unread messages on the menu item label.<br /><br />Now that we have our menu we need to display it. This is the easy part to retrieve the menu from a controller:<br /><br /><script class="brush:php" type="syntaxhighlighter"><![CDATA[  // Get navigation  $this-&gt;view-&gt;navigation = Engine_Api::_()-&gt;getApi('menus', 'core')         -&gt;getNavigation('[menu_name]', [array of options], '[active_menu_item_name]'); ]]></script> And in the view script: <br /><script class="brush:php" type="syntaxhighlighter"><![CDATA[ <div class="tabs"><?php echo $this-&gt;navigation()  -&gt;menu()  -&gt;setContainer($this-&gt;navigation)  -&gt;render(); ?&gt;     </div></script> As discussed earlier most of the menus that appear in the front end of SE4 are wrapped in widgets. In our case we might want to put our menu in a widget which the user can move around in the layout editor.&nbsp; To enable that we would need to create widgets and pages. Which will be the subject of <a href="{{ site.baseurl }}{% post_url 2013-02-10-the-complete-guide-to-social-engine-4 %}">part 6</a>. 